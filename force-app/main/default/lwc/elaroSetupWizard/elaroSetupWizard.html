<template>
  <lightning-card title="Elaro Setup Wizard" icon-name="standard:setup_assistant_guide">
    <div class="slds-var-p-around_medium wizard-container" role="main" aria-label="Elaro Setup Wizard">
      <!-- Progress Indicator -->
      <nav aria-label="Setup wizard progress" class="progress-section">
        <lightning-progress-indicator current-step={currentStep} type="path" variant="base">
          <lightning-progress-step label="Welcome" value="1"></lightning-progress-step>
          <lightning-progress-step label="Frameworks" value="2"></lightning-progress-step>
          <lightning-progress-step label="Notifications" value="3"></lightning-progress-step>
          <lightning-progress-step label="AI Settings" value="4"></lightning-progress-step>
          <lightning-progress-step label="Complete" value="5"></lightning-progress-step>
        </lightning-progress-indicator>
      </nav>

      <!-- Step Content -->
      <div class="step-content">
        <!-- Step 1: Welcome -->
        <template lwc:if={isStep1}>
          <section class="step-panel" aria-labelledby="step1-heading">
            <div class="slds-text-align_center slds-m-bottom_large">
              <lightning-icon
                icon-name="custom:custom63"
                size="xx-large"
                class="slds-m-bottom_medium"
                alternative-text="Elaro logo"
              ></lightning-icon>
              <h2 id="step1-heading" class="slds-text-heading_large slds-m-bottom_small">
                Welcome to Elaro
              </h2>
              <p class="slds-text-body_regular slds-text-color_weak">
                Your AI-powered compliance and governance platform for Salesforce
              </p>
            </div>

            <div class="slds-grid slds-gutters slds-wrap slds-m-top_large">
              <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3 slds-m-bottom_medium">
                <div class="feature-card">
                  <lightning-icon
                    icon-name="utility:shield"
                    size="large"
                    class="feature-icon"
                    alternative-text="Compliance icon"
                  ></lightning-icon>
                  <h3 class="slds-text-heading_small">Multi-Framework Compliance</h3>
                  <p class="slds-text-body_small slds-text-color_weak slds-m-top_small">
                    Track HIPAA, SOC2, GDPR, NIST, and more from a single dashboard
                  </p>
                </div>
              </div>
              <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3 slds-m-bottom_medium">
                <div class="feature-card">
                  <lightning-icon
                    icon-name="utility:Einstein"
                    size="large"
                    class="feature-icon"
                    alternative-text="AI icon"
                  ></lightning-icon>
                  <h3 class="slds-text-heading_small">AI-Powered Analysis</h3>
                  <p class="slds-text-body_small slds-text-color_weak slds-m-top_small">
                    Get intelligent recommendations and automated compliance insights
                  </p>
                </div>
              </div>
              <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3 slds-m-bottom_medium">
                <div class="feature-card">
                  <lightning-icon
                    icon-name="utility:file"
                    size="large"
                    class="feature-icon"
                    alternative-text="Audit icon"
                  ></lightning-icon>
                  <h3 class="slds-text-heading_small">Automated Audit Evidence</h3>
                  <p class="slds-text-body_small slds-text-color_weak slds-m-top_small">
                    Generate audit-ready reports and evidence packages automatically
                  </p>
                </div>
              </div>
            </div>

            <div class="slds-text-align_center slds-m-top_large">
              <p class="slds-text-body_regular">
                This wizard will help you configure Elaro for your organization.
              </p>
              <p class="slds-text-body_small slds-text-color_weak slds-m-top_small">
                Estimated time: 5-10 minutes
              </p>
            </div>
          </section>
        </template>

        <!-- Step 2: Framework Selection -->
        <template lwc:if={isStep2}>
          <section class="step-panel" aria-labelledby="step2-heading">
            <h2 id="step2-heading" class="slds-text-heading_medium slds-m-bottom_small">
              Select Compliance Frameworks
            </h2>
            <p class="slds-text-body_regular slds-m-bottom_large slds-text-color_weak">
              Choose the compliance frameworks your organization needs to track. You can modify this later.
            </p>

            <div
              class="slds-grid slds-wrap slds-gutters"
              role="group"
              aria-label="Available compliance frameworks"
            >
              <template for:each={frameworks} for:item="framework">
                <div
                  key={framework.value}
                  class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-m-bottom_medium"
                >
                  <button
                    class={framework.cardClass}
                    onclick={handleFrameworkToggle}
                    data-value={framework.value}
                    aria-pressed={framework.isSelected}
                    aria-label={framework.ariaLabel}
                    type="button"
                  >
                    <div class="slds-grid slds-grid_vertical-align-center">
                      <lightning-icon
                        icon-name={framework.icon}
                        size="medium"
                        class="slds-m-right_small"
                        alternative-text=""
                      ></lightning-icon>
                      <div>
                        <h3 class="slds-text-heading_small">{framework.label}</h3>
                        <p class="slds-text-body_small slds-text-color_weak">
                          {framework.description}
                        </p>
                      </div>
                    </div>
                  </button>
                </div>
              </template>
            </div>

            <div class="slds-m-top_medium" role="status" aria-live="polite">
              <span class="slds-text-body_small slds-text-color_weak">
                {selectedFrameworksCount} framework(s) selected
              </span>
            </div>
          </section>
        </template>

        <!-- Step 3: Notification Settings -->
        <template lwc:if={isStep3}>
          <section class="step-panel" aria-labelledby="step3-heading">
            <h2 id="step3-heading" class="slds-text-heading_medium slds-m-bottom_small">
              Configure Notifications
            </h2>
            <p class="slds-text-body_regular slds-m-bottom_large slds-text-color_weak">
              Set up how you want to receive compliance alerts and notifications.
            </p>

            <div class="slds-grid slds-gutters slds-wrap">
              <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                <lightning-input
                  type="checkbox"
                  label="Email Notifications"
                  checked={enableEmailNotifications}
                  onchange={handleEmailToggle}
                  class="slds-m-bottom_medium"
                ></lightning-input>

                <template lwc:if={enableEmailNotifications}>
                  <lightning-input
                    type="email"
                    label="Notification Email"
                    value={notificationEmail}
                    onchange={handleEmailChange}
                    placeholder="admin@company.com"
                    class="slds-m-bottom_medium"
                  ></lightning-input>
                </template>

                <lightning-input
                  type="checkbox"
                  label="Slack Integration"
                  checked={enableSlackNotifications}
                  onchange={handleSlackToggle}
                  class="slds-m-bottom_medium"
                ></lightning-input>

                <template lwc:if={enableSlackNotifications}>
                  <lightning-input
                    type="text"
                    label="Slack Webhook URL"
                    value={slackWebhookUrl}
                    onchange={handleSlackUrlChange}
                    placeholder="https://hooks.slack.com/services/..."
                    class="slds-m-bottom_medium"
                  ></lightning-input>
                </template>
              </div>

              <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                <h3 class="slds-text-title_caps slds-m-bottom_small">Alert Thresholds</h3>

                <lightning-combobox
                  label="Alert on Score Below"
                  value={scoreThreshold}
                  options={scoreThresholdOptions}
                  onchange={handleScoreThresholdChange}
                  class="slds-m-bottom_medium"
                ></lightning-combobox>

                <lightning-checkbox-group
                  label="Alert Severity Levels"
                  options={severityOptions}
                  value={selectedSeverities}
                  onchange={handleSeverityChange}
                ></lightning-checkbox-group>
              </div>
            </div>
          </section>
        </template>

        <!-- Step 4: AI Settings -->
        <template lwc:if={isStep4}>
          <section class="step-panel" aria-labelledby="step4-heading">
            <h2 id="step4-heading" class="slds-text-heading_medium slds-m-bottom_small">
              AI Configuration
            </h2>
            <p class="slds-text-body_regular slds-m-bottom_large slds-text-color_weak">
              Configure AI-powered compliance analysis settings.
            </p>

            <lightning-input
              type="checkbox"
              label="Enable AI-Powered Compliance Analysis"
              checked={enableAI}
              onchange={handleAIToggle}
              class="slds-m-bottom_medium"
            ></lightning-input>

            <template lwc:if={enableAI}>
              <div class="ai-settings-panel">
                <div class="slds-grid slds-gutters slds-wrap">
                  <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                    <lightning-input
                      type="checkbox"
                      label="Require Human Approval for High-Risk Recommendations"
                      checked={requireApproval}
                      onchange={handleApprovalToggle}
                      class="slds-m-bottom_medium"
                    ></lightning-input>

                    <lightning-input
                      type="checkbox"
                      label="Enable Auto-Remediation (Advanced)"
                      checked={autoRemediate}
                      onchange={handleRemediationToggle}
                      class="slds-m-bottom_medium"
                    ></lightning-input>
                  </div>

                  <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                    <div class="slds-m-bottom_medium">
                      <label class="slds-form-element__label" id="confidence-label">
                        AI Confidence Threshold
                      </label>
                      <div class="slds-text-align_center slds-m-top_small">
                        <span class="threshold-display" aria-labelledby="confidence-label">
                          {confidenceThresholdDisplay}%
                        </span>
                      </div>
                      <lightning-slider
                        label="Confidence Threshold"
                        value={confidenceThreshold}
                        min="50"
                        max="99"
                        step="1"
                        onchange={handleConfidenceChange}
                        variant="label-hidden"
                      ></lightning-slider>
                      <p class="slds-text-body_small slds-text-color_weak slds-text-align_center">
                        Only apply AI recommendations with confidence above this threshold
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </template>
          </section>
        </template>

        <!-- Step 5: Complete -->
        <template lwc:if={isStep5}>
          <section class="step-panel completion-panel" aria-labelledby="step5-heading">
            <template lwc:if={isSaving}>
              <div role="status" aria-live="polite" aria-busy="true">
                <lightning-spinner
                  alternative-text="Saving configuration"
                  size="large"
                ></lightning-spinner>
                <h2 id="step5-heading-saving" class="slds-text-heading_medium slds-m-top_large">
                  Saving Configuration...
                </h2>
              </div>
            </template>

            <template lwc:if={setupComplete}>
              <div role="status" aria-live="polite">
                <lightning-icon
                  icon-name="utility:success"
                  size="xx-large"
                  variant="success"
                  class="success-icon"
                  alternative-text="Success"
                ></lightning-icon>
                <h2 id="step5-heading-complete" class="slds-text-heading_large slds-m-top_medium">
                  Setup Complete!
                </h2>
                <p class="slds-text-body_regular slds-text-color_weak slds-m-top_small slds-m-bottom_large">
                  Elaro is now configured for your organization.
                </p>

                <div class="slds-box slds-theme_shade slds-m-top_large" style="max-width: 500px; margin: 0 auto;">
                  <h3 class="slds-text-heading_small slds-m-bottom_medium">Configuration Summary</h3>
                  <ul class="slds-list_dotted">
                    <li class="slds-m-bottom_x-small">{selectedFrameworksCount} compliance framework(s) enabled</li>
                    <li class="slds-m-bottom_x-small">
                      Email notifications: {emailNotificationStatus}
                    </li>
                    <li class="slds-m-bottom_x-small">
                      Slack integration: {slackNotificationStatus}
                    </li>
                    <li class="slds-m-bottom_x-small">
                      AI analysis: {aiStatus}
                    </li>
                  </ul>
                </div>

                <div class="slds-m-top_x-large" role="group" aria-label="Next steps">
                  <lightning-button
                    variant="brand"
                    label="Go to Dashboard"
                    onclick={handleGoToDashboard}
                    class="slds-m-right_small"
                  ></lightning-button>
                  <lightning-button
                    label="Run Initial Scan"
                    onclick={handleRunInitialScan}
                  ></lightning-button>
                </div>
              </div>
            </template>

            <template lwc:if={showConfirmation}>
              <div>
                <lightning-icon
                  icon-name="utility:check"
                  size="xx-large"
                  class="slds-m-bottom_medium"
                  alternative-text="Checkmark"
                ></lightning-icon>
                <h2 id="step5-heading-confirm" class="slds-text-heading_medium">
                  Ready to Complete Setup
                </h2>
                <p class="slds-text-body_regular slds-text-color_weak slds-m-top_small slds-m-bottom_large">
                  Review your configuration and click Complete to finish setup.
                </p>

                <div class="slds-box slds-theme_shade" style="max-width: 500px; margin: 0 auto;">
                  <h3 class="slds-text-heading_small slds-m-bottom_medium">Your Configuration</h3>
                  <dl class="slds-dl_horizontal">
                    <dt class="slds-dl_horizontal__label">Frameworks:</dt>
                    <dd class="slds-dl_horizontal__detail">{selectedFrameworksList}</dd>
                    <dt class="slds-dl_horizontal__label">Score Threshold:</dt>
                    <dd class="slds-dl_horizontal__detail">{scoreThreshold}%</dd>
                    <dt class="slds-dl_horizontal__label">AI Enabled:</dt>
                    <dd class="slds-dl_horizontal__detail">{aiStatus}</dd>
                  </dl>
                </div>

                <lightning-button
                  variant="brand"
                  label="Complete Setup"
                  onclick={handleCompleteSetup}
                  class="slds-m-top_large"
                ></lightning-button>
              </div>
            </template>
          </section>
        </template>
      </div>

      <!-- Navigation Buttons -->
      <div class="slds-m-top_large slds-grid slds-grid_align-spread">
        <lightning-button
          label="Previous"
          onclick={handlePrevious}
          disabled={isPreviousDisabled}
        ></lightning-button>
        <lightning-button
          variant="brand"
          label={nextButtonLabel}
          onclick={handleNext}
          disabled={isNextDisabled}
        ></lightning-button>
      </div>
    </div>
  </lightning-card>
</template>
