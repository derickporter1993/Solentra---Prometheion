<template>
  <lightning-card title="Elaro Drill-Down Viewer" icon-name="custom:custom63">
    <div class="slds-p-around_medium">
      <template lwc:if={isLoading}>
        <div class="slds-is-relative slds-p-around_medium">
          <lightning-spinner alternative-text="Loading drill-down data" size="medium"></lightning-spinner>
        </div>
      </template>

      <template lwc:if={hasError}>
        <div class="slds-text-color_error slds-p-around_medium">
          <lightning-icon icon-name="utility:error" size="small" class="slds-m-right_x-small" aria-hidden="true"></lightning-icon>
          {errorMessage}
        </div>
      </template>

      <template lwc:if={notLoading}>
        <template lwc:if={notError}>
          <template lwc:if={hasRecords}>
            <lightning-datatable
              key-field="Id"
              data={records}
              columns={columns}
              hide-checkbox-column
              show-row-number-column
              onrowaction={handleRowAction}
              onsort={handleSort}
              onloadmore={handleLoadMore}
            ></lightning-datatable>
          </template>

          <template lwc:if={noRecords}>
            <div class="slds-text-color_weak slds-p-around_medium slds-text-align_center">
              <lightning-icon icon-name="utility:info" size="small" class="slds-m-right_x-small" aria-hidden="true"></lightning-icon>
              No records found for the selected context
            </div>
          </template>

          <div class="slds-m-top_medium slds-text-align_center">
            <lightning-button
              label="Export to CSV"
              onclick={handleExport}
              disabled={isExportDisabled}
              icon-name="utility:download"
            ></lightning-button>
          </div>
        </template>
      </template>
    </div>
  </lightning-card>
</template>
